I"±/<p><br/><br/></p>
<ul>
<li>ë¬¸ì œ ë°œìƒ ê°œë°œê¸°ë¡
<ul>
<li><a href="https://taegyunwoo.github.io/CRUD_Web/2021-09-24">CRUD Web ê°œë°œì¼ì§€: 2021-09-24</a></li>
</ul>
</li>
</ul>
<br/>
<h1 id="section">ë¬¸ì œ ë°°ê²½</h1>
<ul>
<li><code>BoardController</code> ì»¨íŠ¸ë¡¤ëŸ¬ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ë˜ ì¤‘, ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.</li>
<li><code>BoardController</code> í´ë˜ìŠ¤ì˜ <code>addArticle</code> ë©”ì„œë“œì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì‘ì„±í•˜ë˜ ìƒíƒœë‹¤.</li>
<li>í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ì™„ë£Œ í›„ ì‹¤í–‰ì„ í–ˆëŠ”ë°, 400 ì˜¤ë¥˜ê°€ ë°˜í™˜ë˜ì—ˆë‹¤.</li>
<li><code>BoardController</code> í´ë˜ìŠ¤ì˜ <code>addArticle</code> ë©”ì„œë“œ
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/new-article"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">addArticle</span><span class="o">(</span><span class="nd">@Validated</span> <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"article"</span><span class="o">)</span> <span class="nc">NewArticleForm</span> <span class="n">form</span><span class="o">,</span>
                        <span class="nd">@SessionAttribute</span><span class="o">(</span><span class="s">"loginUser"</span><span class="o">)</span> <span class="nc">User</span> <span class="n">user</span><span class="o">,</span>
                        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">)</span> <span class="o">{</span>
<p><span class="k">if</span> <span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
<span class="k">return</span> <span class="s">â€œadd-articleâ€</span><span class="o">;</span>
<span class="o">}</span></p>
<p><span class="c1">//ë¡œì§â€¦</span></p>
<p><span class="k">return</span> <span class="s">â€œredirect:/board/1â€</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div></p>
</li>
<li><code>BoardControllerTest</code> í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì˜ <code>addArticleTest</code> ë©”ì„œë“œ
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"ê²Œì‹œê¸€ ì¶”ê°€"</span><span class="o">)</span>
<span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">addArticleTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="c1">//given</span>
  <span class="nc">NewArticleForm</span> <span class="n">wrongForm</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">NewArticleForm</span><span class="o">();</span>
  <span class="nc">User</span> <span class="n">loginUser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
  <span class="nc">MockHttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MockHttpSession</span><span class="o">();</span>
<p><span class="n">wrongForm</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">â€â€</span><span class="o">);</span>
<span class="n">wrongForm</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="s">â€â€</span><span class="o">);</span>
<span class="n">loginUser</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">5L</span><span class="o">);</span>
<span class="n">loginUser</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">â€œBoardTestUserâ€</span><span class="o">);</span>
<span class="n">loginUser</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">â€œ<a href="mailto:BoardTestUser@test.com">BoardTestUser@test.com</a>â€</span><span class="o">);</span>
<span class="n">loginUser</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">â€œ123test!â€</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">â€œloginUserâ€</span><span class="o">,</span> <span class="n">loginUser</span><span class="o">);</span></p>
<p><span class="n">given</span><span class="o">(</span><span class="n">boardService</span><span class="o">.</span><span class="na">addNewArticle</span><span class="o">(</span><span class="n">any</span><span class="o">())).</span><span class="na">willReturn</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span></p>
<p><span class="c1">//when</span>
<span class="nc">ResultActions</span> <span class="n">wrongPerform</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span>
<span class="n">post</span><span class="o">(</span><span class="s">â€/board/new-articleâ€</span><span class="o">)</span>
<span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">â€œtitleâ€</span><span class="o">,</span> <span class="n">wrongForm</span><span class="o">.</span><span class="na">getTitle</span><span class="o">())</span>
<span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">â€œcontentâ€</span><span class="o">,</span> <span class="n">wrongForm</span><span class="o">.</span><span class="na">getContent</span><span class="o">())</span>
<span class="o">.</span><span class="na">session</span><span class="o">(</span><span class="n">session</span><span class="o">)</span>
<span class="o">);</span></p>
<p><span class="c1">//then</span>
<span class="n">wrongPerform</span><span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">()).</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">â€œadd-articleâ€</span><span class="o">));</span> <span class="c1">//validation ì‹¤íŒ¨ì‹œ ê¸°ëŒ€ ê²°ê³¼</span>
<span class="o">}</span>
</code></pre></div></div></p>
<ul>
<li>ì˜ë„ì ìœ¼ë¡œ Bean Validationì— ì‹¤íŒ¨í•˜ëŠ” ìš”ì²­ì„ í…ŒìŠ¤íŠ¸í–ˆë‹¤.</li>
<li><code>addArticle</code> ë©”ì„œë“œì—ì„œ Bean Validationì— ì‹¤íŒ¨ì‹œ, <code>add-article</code> ë·°ë¥¼ ì‘ë‹µí•˜ë„ë¡ ë¡œì§ ì‘ì„±í•˜ì˜€ë‹¤.</li>
<li>í•˜ì§€ë§Œ, 400 ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê³  í…ŒìŠ¤íŠ¸ì— ì‹¤íŒ¨í–ˆë‹¤.</li>
</ul>
<blockquote>
<p>Bean Validationì— ì‹¤íŒ¨í•˜ë”ë¼ë„ 200 ì½”ë“œë¡œ <code>add-article</code> ë·°ë¥¼ ì‘ë‹µí•˜ë„ë¡ ì‘ì„±í–ˆëŠ”ëŒ€ë„ ë§ì´ë‹¤.</p>
</blockquote>
</li>
</ul>
<br/>
<ul>
<li>ë°œìƒ ì˜¤ë¥˜
<img src="/assets/img/2021-09-24-TroubleShooting_BeanValidation400Error/Untitled.png" alt="Untitled" /></li>
</ul>
<p><br><br></p>
<h1 id="section-1">ë¬¸ì œ í•´ê²° íƒìƒ‰ê³¼ì •</h1>
<ul>
<li><code>@WebMvcTest</code>ë¥¼ í†µí•´, ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì˜€ë‹¤. ê·¸ì— ë”°ë¼, í…ŒìŠ¤íŠ¸ ê³¼ì •ì—ì„œ Bean Validationì´ ì œëŒ€ë¡œ ì ìš©ë˜ëŠ”ì§€ í™•ì¸í•˜ì˜€ë‹¤.
<ul>
<li>ê·¸ ê²°ê³¼, Bean Validationì€ ì •ìƒ ì‘ë™í•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œì•˜ë‹¤.</li>
</ul>
</li>
<li>ì‹¤ì œ ë¡œì»¬ì— Web App ì‹¤í–‰í•˜ì—¬ í™•ì¸í•´ë³¸ ê²°ê³¼, Bean Validation ì¡°ê±´ì— ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ìš”ì²­ì‹œ, ë¡œì»¬ì—ì„œë„ ë™ì¼í•˜ê²Œ 400 ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.</li>
<li>ë”°ë¼ì„œ, ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ ìˆœì„œê°€ ì˜ì‹¬ë˜ì—ˆë‹¤.</li>
</ul>
<p><br><br></p>
<h1 id="section-2">ë¬¸ì œ í•´ê²°</h1>
<h2 id="section-3">ë¬¸ì œ ì›ì¸</h2>
<ul>
<li><code>BoardController</code> ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤ì˜ <code>addArticle</code> ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ê°€ ë¬¸ì œì˜€ë‹¤.</li>
<li>í•´ë‹¹ ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ ìˆœì„œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
<ol>
<li><code>@Validated @ModelAttribute(&quot;article&quot;) NewArticleForm form</code></li>
<li><code>@SessionAttribute(&quot;loginUser&quot;) User user</code></li>
<li><code>BindingResult bindingResult</code></li>
</ol>
</li>
</ul>
<br/>
<ul>
<li><strong>ìœ„ ìˆœì„œì™€ ê°™ì´ â€œ<code>@Validated</code> ê°€ ì ìš©ëœ ë§¤ê°œë³€ìˆ˜â€ì™€ â€œBindingResult ë§¤ê°œë³€ìˆ˜â€ê°€ ë–¨ì–´ì ¸ì„œ ì‘ì„±ë˜ì–´ ë°œìƒí•˜ëŠ” ë¬¸ì œì˜€ë‹¤.</strong></li>
</ul>
<br/>
<ul>
<li><code>BoardController</code> í´ë˜ìŠ¤ì˜ <code>addArticle</code> ë©”ì„œë“œ
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/new-article"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">addArticle</span><span class="o">(</span><span class="nd">@Validated</span> <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"article"</span><span class="o">)</span> <span class="nc">NewArticleForm</span> <span class="n">form</span><span class="o">,</span>
                        <span class="nd">@SessionAttribute</span><span class="o">(</span><span class="s">"loginUser"</span><span class="o">)</span> <span class="nc">User</span> <span class="n">user</span><span class="o">,</span>
                        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">)</span> <span class="o">{</span>
<p><span class="k">if</span> <span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
<span class="k">return</span> <span class="s">â€œadd-articleâ€</span><span class="o">;</span>
<span class="o">}</span></p>
<p><span class="c1">//ë¡œì§â€¦</span></p>
<p><span class="k">return</span> <span class="s">â€œredirect:/board/1â€</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div></p>
</li>
</ul>
<p><br><br></p>
<h2 id="section-4">í•´ê²°ë°©ë²•</h2>
<ul>
<li><code>@Validated</code> ë§¤ê°œë³€ìˆ˜ì™€ <code>BindingResult</code> ë§¤ê°œë³€ìˆ˜ë¥¼ ì•„ë˜ ìˆœì„œì™€ ê°™ì´ ì‘ì„±í•œë‹¤.
<ol>
<li><code>@Validated</code> ë§¤ê°œë³€ìˆ˜</li>
<li><code>BindingResult</code> ë§¤ê°œë³€ìˆ˜</li>
</ol>
</li>
<li><strong>í•­ìƒ <code>@Validated</code> ë°”ë¡œ ë’¤ì— <code>BindingResult</code> ë§¤ê°œë³€ìˆ˜ê°€ ì™€ì•¼í•œë‹¤.</strong></li>
<li>ì˜ˆì‹œ
<ul>
<li><code>BoardController</code> í´ë˜ìŠ¤ì˜ <code>addArticle</code> ë©”ì„œë“œ</li>
</ul>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/new-article"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">addArticle</span><span class="o">(</span><span class="nd">@SessionAttribute</span><span class="o">(</span><span class="s">"loginUser"</span><span class="o">)</span> <span class="nc">User</span> <span class="n">user</span><span class="o">,</span>
                        <span class="nd">@Validated</span> <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"article"</span><span class="o">)</span> <span class="nc">NewArticleForm</span> <span class="n">form</span><span class="o">,</span>
                        <span class="nc">BindingResult</span> <span class="n">bindingResult</span><span class="o">)</span> <span class="o">{</span>
<p><span class="k">if</span> <span class="o">(</span><span class="n">bindingResult</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
<span class="k">return</span> <span class="s">â€œadd-articleâ€</span><span class="o">;</span>
<span class="o">}</span></p>
<p><span class="c1">//ë¡œì§â€¦</span></p>
<p><span class="k">return</span> <span class="s">â€œredirect:/board/1â€</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div></p>
</li>
</ul>
:ET