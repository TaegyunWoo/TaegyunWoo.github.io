I"Îx<p><br/><br/></p>
<h1 id="codewebmvctestcode--mockmvc-"><code>@WebMvcTest</code> ì• ë„ˆí…Œì´ì…˜ê³¼ MockMvc í™œìš©</h1>
<h2 id="codewebmvctestcode"><code>@WebMvcTest</code></h2>
<h3 id="codewebmvctestcode-"><code>@WebMvcTest</code> ì• ë„ˆí…Œì´ì…˜ì´ë€?</h3>
<ul>
<li>MVCë¥¼ ìœ„í•œ í…ŒìŠ¤íŠ¸ë‚˜, ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í…ŒìŠ¤íŠ¸í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ì• ë„ˆí…Œì´ì…˜ì´ë‹¤.</li>
<li><strong><code>@WebMvcTest</code> ì‚¬ìš©ì‹œ, ìŠ¤ìº” ëŒ€ìƒì„ ì œí•œí•˜ì—¬ <code>@SpringBootTest</code> ë³´ë‹¤ ë¹ ë¥¸ íš¨ìœ¨ì„ ë³´ì—¬ì¤€ë‹¤.</strong></li>
<li><code>@WebMvcTest</code> ê°€ ìŠ¤ìº”í•˜ëŠ” ëŒ€ìƒ ëª©ë¡
<ul>
<li><code>@Controller</code></li>
<li><code>@ControllerAdvice</code></li>
<li><code>@JsonComponent</code></li>
<li><code>Converter</code></li>
<li><code>GenericConverter</code></li>
<li><code>Filter</code></li>
<li><code>HandlerInterceptor</code></li>
<li><code>WebMvcConfigurer</code></li>
<li><code>HandlerMethodArgumentResolver</code></li>
</ul>
</li>
</ul>
<br/>
<h3 id="codewebmvctestcode-----"><code>@WebMvcTest</code> ê°€ ìë™ìœ¼ë¡œ ì¶”ê°€í•˜ëŠ” í•­ëª© ë¦¬ìŠ¤íŠ¸</h3>
<ul>
<li><code>@WebMvcTest</code> ê°€ <strong>Auto Configure</strong>í•˜ëŠ” í•­ëª©ì€ ë‹¤ìŒ ë¬¸ì„œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</li>
<li><code>@WebMvcTest</code> ë¿ë§Œ ì•„ë‹ˆë¼, ë‹¤ì–‘í•œ Testì— ëŒ€í•œ Auto Configure í•­ëª©ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</li>
</ul>
<p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/test-auto-configuration.html#test-auto-configuration">ê³µì‹ ë¬¸ì„œ ë§í¬</a></p>
<br/>
<h3 id="section">ì¥ì </h3>
<ul>
<li>Web Applicationê³¼ ê´€ë ¨ëœ Beanë“¤ë§Œ ë“±ë¡í•˜ê¸° ë•Œë¬¸ì—, í†µí•© í…ŒìŠ¤íŠ¸(<code>@SpringBootTest</code>)ë³´ë‹¤ ë¹ ë¥´ê²Œ ìˆ˜í–‰ëœë‹¤.</li>
<li>í†µí•© í…ŒìŠ¤íŠ¸ë¡œ ìˆ˜í–‰í•˜ê¸° í˜ë“  í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
<ul>
<li>Ex) ê²°ì œ ëª¨ë“ˆ í…ŒìŠ¤íŠ¸ì‹œ, ê°€ì§œ Mock ê°ì²´ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ìˆë‹¤.</li>
</ul>
</li>
</ul>
<br/>
<h3 id="section-1">ë‹¨ì </h3>
<ul>
<li>ìš”ì²­ë¶€í„° ì‘ë‹µê¹Œì§€ ëª¨ë“  í…ŒìŠ¤íŠ¸ë¥¼ Mock ê¸°ë°˜ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.</li>
</ul>
<br/>
<h3 id="codewebmvctestcode-vs-codespringboottestcode"><code>@WebMvcTest</code> vs <code>@SpringBootTest</code></h3>
<ul>
<li><code>@WebMvcTest</code>
<ul>
<li><strong>íŠ¹ì • ë ˆì´ì–´ë§Œì„ í…ŒìŠ¤íŠ¸í•œë‹¤. (ìœ ë‹› í…ŒìŠ¤íŠ¸)</strong></li>
<li><strong>ë§Œì•½ ë‹¤ë¥¸ ë ˆì´ì–´ì— í•´ë‹¹í•˜ëŠ” ë¹ˆì´ í•„ìš”í•˜ë‹¤ë©´ Mock ê°ì²´ë¡œ ë§Œë“¤ì–´ì•¼í•œë‹¤.</strong></li>
<li>ë ˆì´ì–´ì— í•´ë‹¹í•˜ëŠ” ë¹ˆë§Œì„ ê°€ì ¸ì˜¤ë¯€ë¡œ ì†ë„ê°€ ë¹„êµì  ë¹ ë¥´ë‹¤.</li>
<li>ì›¹ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™” í•˜ì§€ë§Œ ëª¨ë“  ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ MVCë ˆì´ì–´ì™€ ê´€ë ¨ëœ ì„¤ì •ë§Œ ë¶ˆëŸ¬ì˜¨ë‹¤.</li>
<li>HTTP ìš”ì²­ì€ mockì„ ì´ìš©í•´ ê°€ì§œë¡œ ì´ë¤„ì§€ê³  ì‹¤ì œ ì—°ê²°ì€ ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤.</li>
</ul>
</li>
</ul>
<br/>
<ul>
<li><code>@SpringBootTest</code>
<ul>
<li><strong>Application Context ì „ì²´ë¥¼ í…ŒìŠ¤íŠ¸í•œë‹¤. (í†µí•© í…ŒìŠ¤íŠ¸)</strong></li>
<li>ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë“  ë²”ìœ„ë¥¼ ë¶ˆëŸ¬ì™€ì•¼í•˜ë¯€ë¡œ ì†ë„ê°€ ëŠë¦¬ë‹¤.</li>
<li>ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í¬ê¸°ê°€ ì»¤ì§ˆìˆ˜ë¡ ë¶ˆë¦¬í•˜ë‹¤.</li>
<li>ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì™€ ì„¤ì •ì„ ëª¨ë‘ ë¶ˆëŸ¬ì™€ ì‹¤ì œ ì›¹ ì„œë²„ì— ì—°ê²°ì„ ì‹œë„í•œë‹¤.</li>
</ul>
</li>
</ul>
<br/>
<ul>
<li><strong>ì¦‰, <code>@WebMvcTest</code> ì™€ <code>@SpringBootTest</code> ì˜ ê°€ì¥ í° ì°¨ì´ì ì€ ì–¼ë§ˆë‚˜ ë§ì€ ì„¤ì •ê³¼ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠëƒì— ìˆë‹¤.</strong></li>
</ul>
<p><br/><br/></p>
<h2 id="mockmvc">MockMvc</h2>
<h3 id="mockmvc-1">MockMvcë€?</h3>
<ul>
<li>MockMvcëŠ” ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì˜ êµ¬ë™ ì—†ì´, ì‹œë®¬ë ˆì´ì…˜ëœ MVC í™˜ê²½ì— ëª¨ì˜ HTTP ì„œë¸”ë¦¿ ìš”ì²­ì„ ì „ì†¡í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ë‹¤.</li>
<li>ì¦‰, ì£¼ë¡œ Testì— ì‚¬ìš©ë˜ëŠ” (íŠ¹íˆ ìœ ë‹›í…ŒìŠ¤íŠ¸) ê°€ì§œ HTTP í†µì‹  ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤.</li>
</ul>
<br/>
<h3 id="section-2">ê´€ë ¨ ì£¼ìš” ë©”ì„œë“œ</h3>
<ul>
<li><code>MockMvc</code> ê´€ë ¨ ë©”ì„œë“œ
<ul>
<li><code>mockMvc.perform(RequestBuilder requestBuilder)</code>
<ul>
<li>ê°€ì§œ HTTP ìš”ì²­ì„ ìˆ˜í–‰í•˜ê³  <code>ResultActions</code> ê°ì²´ (ê²°ê³¼ ë°ì´í„°)ë¥¼ ë°˜í™˜í•œë‹¤.</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/web/servlet/MockMvc.html">ê³µì‹ API ë¬¸ì„œ</a></li>
</ul>
</li>
</ul>
<br/>
<ul>
<li><code>RequestBuilder</code> ê´€ë ¨ ë©”ì„œë“œ
<ul>
<li><code>get(&quot;ìš”ì²­URL&quot;)</code>, <code>post(&quot;ìš”ì²­URL&quot;)</code>, <code>put(&quot;ìš”ì²­URL&quot;)</code>, <code>delete(&quot;ìš”ì²­URL&quot;)</code> â€¦
<ul>
<li>ë©”ì„œë“œ ë°©ì‹ì„ ì„ íƒí•˜ì—¬ ê°€ì§œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.</li>
</ul>
</li>
<li><code>content()</code>
<ul>
<li>ìš”ì²­ ë©”ì‹œì§€ì˜ ë°”ë””ë¥¼ ì§ì ‘ ì…ë ¥í•  ìˆ˜ ìˆë‹¤.</li>
</ul>
</li>
<li><code>contentType()</code>
<ul>
<li>ìš”ì²­ ë©”ì‹œì§€ì˜ contentType í—¤ë”ë¥¼ ì„¤ì •í•œë‹¤.</li>
</ul>
</li>
<li><code>accept()</code>
<ul>
<li>ìš”ì²­ ë©”ì‹œì§€ì˜ accept í—¤ë”ë¥¼ ì„¤ì •í•œë‹¤.</li>
</ul>
</li>
<li><code>session()</code>
<ul>
<li>ìš”ì²­ ë©”ì‹œì§€ì™€ í•¨ê»˜ ë³´ë‚¼ ì„¸ì…˜ì„ ì„¤ì •í•œë‹¤.</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/web/servlet/RequestBuilder.html">ê³µì‹ API ë¬¸ì„œ</a></li>
</ul>
</li>
</ul>
<br/>
<ul>
<li><code>ResultActions</code> ê´€ë ¨ ë©”ì„œë“œ
<ul>
<li><code>resultActions.andExpect(ResultMatcher matcher)</code>
<ul>
<li><code>ResultActions</code> ê°ì²´ (ê²°ê³¼ ë°ì´í„°)ë¥¼ ê²€ì¦í•œë‹¤.</li>
<li>ë§¤ê°œë³€ìˆ˜(ResultMatcher)ë¡œ <code>status().isOk()</code> , <code>content()</code> ë“±ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.</li>
<li>ê²€ì¦í•  ìˆ˜ ìˆëŠ” ì¢…ë¥˜ëŠ” <strong><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/web/servlet/result/MockMvcResultMatchers.html">ê³µì‹ë¬¸ì„œ ì°¸ê³ </a></strong></li>
</ul>
</li>
<li><code>resultActions.andDo(ResultHandler handler)</code>
<ul>
<li>ê°€ì§œìš”ì²­ì— ì‘ë‹µí•œ ê²°ê³¼ì— ëŒ€í•œ ë™ì‘ì„ ì„¤ì •í•œë‹¤.</li>
<li>ì£¼ìš” ë§¤ê°œë³€ìˆ˜: <code>print()</code></li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/web/servlet/ResultActions.html">ê³µì‹ API ë¬¸ì„œ</a></li>
</ul>
</li>
</ul>
<br/>
<ul>
<li><code>ResultHandler</code> ê´€ë ¨ ë©”ì„œë“œ
<ul>
<li><code>print()</code>
<ul>
<li><code>andDo()</code> ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•˜ì—¬ ì‘ë‹µ ê²°ê³¼ë¥¼ ì¶œë ¥í•˜ë„ë¡ ì„¤ì •í•œë‹¤.</li>
</ul>
</li>
<li><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/web/servlet/ResultHandler.html">ê³µì‹ API ë¬¸ì„œ</a></li>
</ul>
</li>
</ul>
<p><br/><br/><br/></p>
<h1 id="section-3">ì¢…í•© ì˜ˆì‹œ</h1>
<h2 id="spring-boot-starter-test--">spring-boot-starter-test ì˜ì¡´ì„± ì¶”ê°€</h2>
<ul>
<li><code>@WebMvcTest</code> ë¥¼ ë¹„ë¡¯í•œ ë‹¤ì–‘í•œ í…ŒìŠ¤íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´, spring-boot-starter-test ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì•¼í•œë‹¤.</li>
</ul>
<br/>
<h3 id="codebuildgradlecode-"><code>build.gradle</code> íŒŒì¼</h3>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dependencies</span> <span class="o">{</span>
	<span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-test'</span>
<span class="o">}</span>
</code></pre></div></div>
<p><br/><br/></p>
<h2 id="lombok--">Lombok ì˜ì¡´ì„± ì„¤ì •</h2>
<ul>
<li>ë§Œì•½ í”„ë¡œì íŠ¸ì—ì„œ Lombokì„ ì‚¬ìš©í•œë‹¤ë©´, í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œë„ ì ìš©í•  ìˆ˜ ìˆë„ë¡ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•´ì•¼í•œë‹¤.</li>
</ul>
<br/>
<h3 id="codebuildgradlecode--1"><code>build.gradle</code> íŒŒì¼</h3>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dependencies</span> <span class="o">{</span>
	<span class="n">implementation</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">:</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">test</span><span class="err">'</span>

	<span class="c1">//ê¸°ì¡´</span>
	<span class="n">compileOnly</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">projectlombok</span><span class="o">:</span><span class="n">lombok</span><span class="err">'</span>
	<span class="n">annotationProcessor</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">projectlombok</span><span class="o">:</span><span class="n">lombok</span><span class="err">'</span>

	<span class="c1">//ì¶”ê°€</span>
	<span class="n">testCompileOnly</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">projectlombok</span><span class="o">:</span><span class="n">lombok</span><span class="err">'</span>
	<span class="n">testAnnotationProcessor</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">projectlombok</span><span class="o">:</span><span class="n">lombok</span><span class="err">'</span>
<span class="o">}</span>
</code></pre></div></div>
<p><br/><br/></p>
<h2 id="section-4">í”„ë¡œì íŠ¸ ì†ŒìŠ¤</h2>
<blockquote>
<p><strong><a href="https://github.com/TaegyunWoo/basic-web-CRUD">ì˜ˆì‹œ í”„ë¡œì íŠ¸ ë‹¤ìš´ë¡œë“œ</a></strong></p>
</blockquote>
<br/>
<h3 id="codeboardcontrollercode-"><code>BoardController</code> í´ë˜ìŠ¤</h3>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">web.crud.basic.basicweb.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">...</span>

<span class="nd">@RequiredArgsConstructor</span> <span class="c1">//build.gradleì— ì„¤ì •í•´ë‘ì—ˆê¸° ë•Œë¬¸ì—, í…ŒìŠ¤íŠ¸ì½”ë“œì—ì„œë„ ì‘ë™í•œë‹¤.</span>
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/board"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoardController</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="nc">BoardService</span> <span class="n">boardService</span><span class="o">;</span>

  <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/{pageNum}"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">showBoard</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="kt">int</span> <span class="n">pageNum</span><span class="o">,</span>
                          <span class="nd">@SessionAttribute</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"loginUser"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> <span class="nc">User</span> <span class="n">loginUser</span><span class="o">,</span>
                          <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                          <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">String</span> <span class="n">currentPageNum</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">"/"</span><span class="o">)[</span><span class="mi">2</span><span class="o">];</span>

    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Article</span><span class="o">&gt;</span> <span class="n">articleList</span> <span class="o">=</span> <span class="n">boardService</span><span class="o">.</span><span class="na">getAllArticles</span><span class="o">();</span>
    <span class="kt">int</span><span class="o">[]</span> <span class="n">totalPageNumArr</span> <span class="o">=</span> <span class="n">getTotalPageNumArr</span><span class="o">(</span><span class="n">articleList</span><span class="o">);</span>

    <span class="nc">Collections</span><span class="o">.</span><span class="na">reverse</span><span class="o">(</span><span class="n">articleList</span><span class="o">);</span>
    <span class="n">articleList</span> <span class="o">=</span> <span class="n">getArticlesOfPage</span><span class="o">(</span><span class="n">pageNum</span><span class="o">,</span> <span class="n">articleList</span><span class="o">);</span>

    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"articleList"</span><span class="o">,</span> <span class="n">articleList</span><span class="o">);</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"totalPageNumArr"</span><span class="o">,</span> <span class="n">totalPageNumArr</span><span class="o">);</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"currentPageNum"</span><span class="o">,</span> <span class="n">currentPageNum</span><span class="o">);</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"totalPageNum"</span><span class="o">,</span> <span class="n">totalPageNumArr</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>

    <span class="k">return</span> <span class="s">"board"</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">int</span><span class="o">[]</span> <span class="nf">getTotalPageNumArr</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Article</span><span class="o">&gt;</span> <span class="nc">TotalArticles</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">double</span> <span class="n">totalArticleSize</span> <span class="o">=</span> <span class="nc">TotalArticles</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">pageNum</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="nc">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">(</span><span class="n">totalArticleSize</span><span class="o">/</span><span class="mi">3</span><span class="o">);</span>
    <span class="kt">int</span><span class="o">[]</span> <span class="n">pageNumArr</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">pageNum</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">pageNumArr</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">pageNumArr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">pageNumArr</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>
<br/>
<h3 id="codeboardcontrollertestcode--"><code>BoardControllerTest</code> í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤</h3>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">web.crud.basic.basicweb.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.extension.ExtendWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mockito.Mock</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mockito.junit.jupiter.MockitoExtension</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.mock.web.MockHttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.ContextConfiguration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.MockMvc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.ResultActions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.ResultMatcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.setup.MockMvcBuilders</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">web.crud.basic.basicweb.Service.BoardService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">web.crud.basic.basicweb.WebConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">web.crud.basic.basicweb.domain.Article</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">web.crud.basic.basicweb.domain.ArticleMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">web.crud.basic.basicweb.domain.User</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">mockito</span><span class="o">.</span><span class="na">BDDMockito</span><span class="o">.</span><span class="na">given</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">MockMvcRequestBuilders</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultHandlers</span><span class="o">.</span><span class="na">print</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultMatchers</span><span class="o">.</span><span class="na">content</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultMatchers</span><span class="o">.</span><span class="na">status</span><span class="o">;</span>

<span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">MockitoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">//Mock ê°ì²´ë¥¼ ìœ„í•œ í™•ì¥ëª¨ë¸ ë“±ë¡</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">classes</span> <span class="o">=</span> <span class="nc">WebConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">//Application Context(ì„¤ì •) ë“±ë¡</span>
<span class="nd">@WebMvcTest</span><span class="o">(</span><span class="nc">BoardController</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">//í…ŒìŠ¤íŠ¸í•  ì»¨íŠ¸ë¡¤ëŸ¬ ì§€ì •</span>
<span class="kd">class</span> <span class="nc">BoardControllerTest</span> <span class="o">{</span>

    <span class="nd">@Mock</span>
    <span class="kd">private</span> <span class="nc">BoardService</span> <span class="n">boardService</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span> <span class="c1">//@Autowired ê°€ ì—†ìŒì— ì£¼ì˜!</span>

    <span class="c1">//MockMvcê°€ BoardController ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •</span>
    <span class="nd">@BeforeEach</span>
    <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">mockMvc</span> <span class="o">=</span> <span class="nc">MockMvcBuilders</span><span class="o">.</span><span class="na">standaloneSetup</span><span class="o">(</span><span class="k">new</span> <span class="nc">BoardController</span><span class="o">(</span><span class="n">boardService</span><span class="o">)).</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"ê²Œì‹œíŒ ë³´ì´ê¸° í…ŒìŠ¤íŠ¸"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">showBoardTest</span><span class="o">(</span><span class="nd">@Mock</span> <span class="nc">ArticleMapper</span> <span class="n">articleMapper</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      <span class="c1">//---------- given ----------</span>
      <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Article</span><span class="o">&gt;</span> <span class="n">articleList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
      <span class="nc">Article</span> <span class="n">article1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Article</span><span class="o">();</span>
      <span class="nc">Article</span> <span class="n">article2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Article</span><span class="o">();</span>
      <span class="nc">MockHttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MockHttpSession</span><span class="o">();</span>
      <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>

      <span class="n">article1</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"Article1"</span><span class="o">);</span>
      <span class="n">article1</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="s">"Article1 Content"</span><span class="o">);</span>
      <span class="n">article1</span><span class="o">.</span><span class="na">setWriter</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
      <span class="n">article1</span><span class="o">.</span><span class="na">setDateTime</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>

      <span class="n">article2</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"Article2"</span><span class="o">);</span>
      <span class="n">article2</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="s">"Article2 Content"</span><span class="o">);</span>
      <span class="n">article2</span><span class="o">.</span><span class="na">setWriter</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
      <span class="n">article2</span><span class="o">.</span><span class="na">setDateTime</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>

      <span class="n">articleList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">article1</span><span class="o">);</span>
      <span class="n">articleList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">article2</span><span class="o">);</span>

      <span class="n">user</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"mockUser@test.com"</span><span class="o">);</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">5L</span><span class="o">);</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"123test!"</span><span class="o">);</span>
      <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"mockUser"</span><span class="o">);</span>

      <span class="c1">//ë¡œê·¸ì¸ ì‚¬ìš©ì ì„¸ì…˜ ì¶”ê°€</span>
      <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"loginUser"</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>

      <span class="n">given</span><span class="o">(</span><span class="n">boardService</span><span class="o">.</span><span class="na">getAllArticles</span><span class="o">()).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">articleList</span><span class="o">);</span>

      <span class="c1">//---------- when ----------</span>
      <span class="nc">ResultActions</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/board/{pageNum}"</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
          <span class="o">.</span><span class="na">session</span><span class="o">(</span><span class="n">session</span><span class="o">)</span> <span class="c1">//ì„¸ì…˜ ì •ë³´ ì¶”ê°€</span>
      <span class="o">);</span>

      <span class="c1">//---------- then ----------</span>
      <span class="n">actions</span><span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">()).</span><span class="na">andDo</span><span class="o">(</span><span class="n">print</span><span class="o">());</span>

    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>
<ul>
<li><code>@ContextConfiguration(classes = WebConfig.class)</code>
<ul>
<li><strong>ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„¤ì •ì •ë³´(Application Context)ë¥¼ ì§€ì •í•œë‹¤.</strong></li>
<li><code>WebConfig.class</code> ëŠ” <code>WebMvcConfigurer</code> ë¥¼ implementsí•œ í´ë˜ìŠ¤ì´ë©°, ì¸í„°ëŸ½íŠ¸ ë“±ë¡ ë“±ì˜ ì‘ì—…ì„ ì„¤ì •í•œë‹¤.</li>
</ul>
</li>
</ul>
<br/>
<ul>
<li><code>@WebMvcTest(BoardController.class)</code>
<ul>
<li><strong><code>BoardController</code> ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í…ŒìŠ¤íŠ¸í•  ê²ƒì„ì„ ì„¤ì •í•œë‹¤.</strong></li>
</ul>
</li>
</ul>
<br/>
<ul>
<li><code>@Mock private BoardService boardService;</code>
<ul>
<li><code>BoardController</code> ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´, í•„ìš”í•œ ê°ì²´ë¥¼ Mockìœ¼ë¡œ ë§Œë“ ë‹¤.</li>
<li><strong>ì¦‰, <code>BoardController</code> ì˜ ìƒì„±ìë¡œ ë°›ì•„ì•¼í•˜ëŠ” <code>BoardService</code> ê°ì²´ë¥¼ Mockìœ¼ë¡œ ë§Œë“ ë‹¤.</strong></li>
</ul>
</li>
</ul>
<br/>
<ul>
<li><code>private MockMvc mockMvc</code>
<ul>
<li><strong><code>@Autowired</code> ë¥¼ ì ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. ì™œëƒí•˜ë©´ <code>@BeforeEach</code> ë¥¼ ì ìš©í•œ ë©”ì„œë“œë¥¼ í†µí•´, í…ŒìŠ¤íŠ¸í•  ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì„¤ì •í•˜ì—¬ <code>mockMvc</code> ë³€ìˆ˜ì— ì €ì¥í•  ê²ƒì´ê¸° ë•Œë¬¸ì´ë‹¤.</strong></li>
</ul>
</li>
</ul>
<br/>
<ul>
<li><code>mockMvc = MockMvcBuilders.standaloneSetup(new BoardController(boardService)).build();</code>
<ul>
<li><strong><code>MockMvc</code>ê°€ <code>BoardController</code> ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•œë‹¤.</strong></li>
</ul>
</li>
</ul>
<br/>
<ul>
<li><code>actions.andExpect(status().isOk()).andDo(print());</code>
<ul>
<li><strong>ìš”ì²­ì— ëŒ€í•œ ê²€ì¦ì„ ìˆ˜í–‰í•œë‹¤.</strong></li>
<li>200 ìƒíƒœì½”ë“œì¸ì§€ í™•ì¸í•˜ê³ </li>
<li>ì‘ë‹µ ë©”ì‹œì§€ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•œë‹¤.</li>
</ul>
</li>
</ul>
<br/>
<blockquote>
<p>ë³´ë‹¤ ìì„¸í•œ ì‚¬ìš©ì˜ˆì‹œëŠ” ë‹¤ìŒ ë§í¬ë¥¼ ì°¸ê³ : <strong><a href="https://howtodoinjava.com/spring-boot2/testing/spring-boot-mockmvc-example/">ì‚¬ìš© ì¢…í•© ì˜ˆì‹œ ë§í¬</a></strong></p>
</blockquote>
<br/>
<hr/>
<br/>
<blockquote>
<p>ë³¸ í¬ìŠ¤íŠ¸ëŠ” ê°“ëŒ€í¬ë‹˜ì˜ í¬ìŠ¤íŒ…ì„ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤.<br />
ê´€ë ¨ ë§í¬: <a href="https://goddaehee.tistory.com/212?category=367461">https://goddaehee.tistory.com/212?category=367461</a></p>
</blockquote>
:ET